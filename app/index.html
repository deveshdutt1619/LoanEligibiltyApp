<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Blob Upload + Logic App Trigger</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-10">
  <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full space-y-6">
    <h1 class="text-xl font-bold text-center text-blue-700">ðŸ“¤ Upload File to Azure</h1>
    
    <input type="file" id="fileInput" class="block w-full text-sm border border-gray-300 rounded px-3 py-2">
    <button onclick="uploadFile()" class="bg-blue-600 hover:bg-blue-700 text-white w-full py-2 rounded">Upload to Blob</button>

    <button onclick="triggerLogicApp()" class="bg-green-600 hover:bg-green-700 text-white w-full py-2 rounded">Trigger Logic App Manually</button>

    <div id="status" class="text-sm text-center text-gray-700"></div>
  </div>

  <script>
    const blobSasUrl = "https://storagealpha05.blob.core.windows.net/containeralpha05?sp=r&st=2025-06-08T17:25:26Z&se=2025-06-09T01:25:26Z&spr=https&sv=2024-11-04&sr=c&sig=1T7ls6cDLVWfH5QkATAO3gGRP8rGvI9oZYxxlGBb5BU%3D"; // e.g., https://yourstorage.blob.core.windows.net/uploads?sp=...
    const logicAppUrl = "<https://prod-28.southindia.logic.azure.com:443/workflows/f3581618201f4321b5ae1bd228ed81be/triggers/When_a_HTTP_request_is_received/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2FWhen_a_HTTP_request_is_received%2Frun&sv=1.0&sig=QQlEHOiPXi4Fi1dpaRZyClDRL4jPNbyFCV-o2OMmLe4";

    async function uploadFile() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("Please select a file");

      const uploadUrl = `${blobSasUrl}/${file.name}`;
      const res = await fetch(uploadUrl, {
        method: "PUT",
        headers: {
          "x-ms-blob-type": "BlockBlob",
          "Content-Type": file.type
        },
        body: file
      });

      if (res.ok) {
        document.getElementById("status").innerText = `File uploaded to Blob: ${file.name}`;
      } else {
        document.getElementById("status").innerText = "Upload failed";
      }
    }

    async function triggerLogicApp() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("Please select a file");

      const payload = {
        filename: file.name,
        userId: "12345" // Optional: add user/session info
      };

      const res = await fetch(logicAppUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        document.getElementById("status").innerText = `Logic App triggered`;
      } else {
        document.getElementById("status").innerText = `Logic App failed`;
      }
    }
  </script>
</body>
</html>
